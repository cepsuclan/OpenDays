<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>University of Lancashire : Cyber Breach - Log Analysis (Level 2)</title>
<style>
    :root{
        --bg:#1a1a2e;
        --panel:#0f0f1b;
        --accent:#00ff00;
        --muted:#ccc;
        --gold:#ffaa00;
    }
    html,body{height:100%; margin:0; background:var(--bg); color:#e0e0e0; font-family: "Courier New", Courier, monospace;}
    .top-nav {
        display:flex;
        gap:8px;
        align-items:center;
        padding:10px 16px;
        background: linear-gradient(180deg, rgba(0,0,0,0.12), transparent);
        border-bottom:1px solid rgba(255,255,255,0.02);
        position: sticky;
        top: 0;
        z-index: 50;
    }
    .tabs {
        display:flex;
        gap:6px;
        align-items:center;
    }
    .tab {
        display:inline-block;
        padding:8px 14px;
        border-radius:8px;
        color: #e9ffe9;
        text-decoration:none;
        background: transparent;
        border: 1px solid rgba(0,255,0,0.06);
        transition: background 160ms, transform 120ms;
        font-weight:600;
        font-size:0.95rem;
    }
    .tab:hover{ transform: translateY(-2px); background: rgba(0,255,0,0.04); }
    .tab.active{
        background: var(--accent);
        color: #1a1a2e;
        box-shadow: 0 6px 18px rgba(0,255,65,0.12);
    }
    .brand {
        margin-left: auto;
        font-size:0.95rem;
        color: var(--muted);
    }
    .container {
        display: flex;
        flex-direction: row;
        gap: 20px;
        max-width: 1400px;
        margin: 18px auto;
        padding: 0 12px;
    }
    .panel {
        background-color: var(--panel);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.14);
        margin-bottom: 20px;
    }
    #controls-panel { flex: 0 0 360px; order: 2; }
    #log-viewer { flex-grow: 1; order: 1; }
    h2,h3{ color: var(--accent); border-bottom:1px solid var(--accent); padding-bottom:6px; font-size:1.15rem; margin:0 0 10px 0;}
    strong{ color: var(--gold); font-weight:700; }
    a { color: var(--gold); text-decoration: underline; }

    #ipFilter, #answerInput {
        width:100%;
        padding:12px;
        margin:10px 0;
        border-radius:8px;
        border:1px solid var(--accent);
        background:#2a2a44;
        color:#fff;
        box-sizing:border-box;
        font-size:1rem;
    }
    button {
        background: var(--accent);
        color:#1a1a2e;
        border:none;
        padding:10px 12px;
        border-radius:6px;
        cursor:pointer;
        font-weight:700;
        width:100%;
    }
    button:hover{ filter:brightness(0.95); }

    #logTable{ width:100%; border-collapse:collapse; font-size:0.82rem; table-layout:fixed; }
    #logTable th, #logTable td{ padding:6px 8px; border-bottom:1px dashed rgba(58,58,94,0.6); text-align:left; word-wrap:break-word; }
    #logTable th{ background:var(--accent); color:#121212; position:sticky; top:0; z-index:1; }

    .status-message{ margin-top:10px; padding:10px; border-radius:6px; font-weight:700;}
    .status-message.success{ background:#145a32; color:#a9ffb4; }
    .status-message.error{ background:#6e1414; color:#ffb4b4; }

    .intro-text{ color:#ccc; margin-bottom:12px; font-size:0.95rem; }

    .log-filter-container { background: linear-gradient(135deg,#07121a 0%, rgba(0,255,65,0.02) 100%); border:2px solid var(--accent); padding:10px; border-radius:8px; }
    .filter-label{ color:var(--accent); font-weight:700; margin-bottom:6px; display:block; }

    .network-tip{ font-size:0.9rem; margin-top:10px; padding:10px; border:1px solid var(--accent); border-radius:6px; color:#ccc; background:#15152a; }
    .network-tip strong{ color:var(--accent); }
    
    .action-header {
        color: var(--gold);
        font-weight: 700;
        text-shadow: 0 0 4px rgba(255, 170, 0, 0.5);
    }

    @media (max-width:820px){
        .container{ flex-direction:column; padding:0 10px; }
        #controls-panel{ order: 3; width:100%; flex-basis:auto; }
        #log-viewer{ order:1; }
        .top-nav{ padding:8px; }
    }
</style>
</head>
<body>

<div class="top-nav" role="navigation" aria-label="Primary">
    <div class="tabs" role="tablist" aria-label="Main tabs">
        <a href="detective.html" class="tab" role="tab" aria-selected="false">Level 1 Dashboard</a>
        <a href="Report.html" class="tab" role="tab" aria-selected="false">Level 1 Report</a>
        <a href="detective2.html" class="tab active" role="tab" aria-selected="true">Level 2 Dashboard</a>
        <a href="Report2.html" class="tab" role="tab" aria-selected="false">Level 2 Report</a>
        <a href="Breach Sim.html" class="tab" role="tab" aria-selected="false">Breach Sim</a>
    </div>
    <div class="brand">University of Lancashire ‚Äî Training</div>
</div>

<div class="container">
    <div id="log-viewer" class="panel" aria-live="polite">
        <h2>Network Traffic Log (Level 2: Advanced Evasion)</h2>
        <div id="log-output-container" style="max-height:74vh; overflow:auto;">
            <table id="logTable" aria-describedby="logDescription">
                <thead>
                    <tr><th>Time</th><th>Source_IP</th><th>Target_IP</th><th>Action_Summary</th></tr>
                </thead>
                <tbody id="log-body"></tbody>
            </table>
            <div id="logDescription" style="display:none;">This table shows recorded network events in chronological order.</div>
        </div>
    </div>

    <div id="controls-panel" class="panel" role="region" aria-labelledby="current-step-title">
        <h2>Network Analysis Task</h2>

        <div id="narrative-section">
            <h3 id="current-step-title">Objective 1: Find Where the Attacker Got In</h3>
            <p class="intro-text">
                Welcome back, Investigator! The logs are much noisier now. This attack uses a different method of entry but the goal is the same: to find confidential data.
            </p>

            <p class="intro-text">
                Each <strong>IP address</strong> you see is like a digital street address for a computer.
                <br><small>Addresses beginning with <code>192.168</code> are <strong>internal</strong>. Any other address could be and  <strong>external</strong>.</small>
            </p>

            <p id="narrative-text"><span class="action-header">Your Task:</span>
                Find the first time an <strong>external computer</strong> (not 192.168.x.x) successfully connected to your network.
            </p>
        </div>

        <input type="text" id="answerInput" placeholder="Enter your answer here" aria-label="Submit evidence">
        <button onclick="validateAnswer()">Submit Evidence</button>
        <div id="statusMessage" class="status-message" role="status" aria-live="polite"></div>

        <div id="next-level-container" style="margin-top:12px;"></div>

               <hr style="border-color: rgba(58,58,94,0.6); margin: 15px 0;">

        
        <div id="log-filter-section" class="log-filter-container" aria-labelledby="log-filter-label">
            <div class="filter-label" id="log-filter-label">Log Filter</div>
            <p id="strategy-tip" style="margin-top:8px; color:#bfffbf; font-size:0.92rem;">
                Strategy: Filter by protocol keywords like "SSH", "SQL", or "transfer" to isolate malicious activity.
            </p>
            <div class="filter-input-row" style="margin-top:8px;">
                <input type="text" id="ipFilter" placeholder="Filter by IP, target, or keyword" onkeyup="filterLogs()" aria-label="Log filter">
            </div>
        </div>

        <div id="dynamic-help-section">
            <div class="network-tip" role="note">
                <strong>Networking Tip:</strong>
                <span> ‚Äú192.168.x.x‚Äù addresses belong to your local network ‚Äî like rooms inside a building. Anything else is from the outside world.</span>
            </div>
        </div>
         <div class="logo-footer" style="text-align:center; margin-top:14px; padding-top:10px; border-top:1px dashed rgba(58,58,94,0.6);">
            <img src="university_of_lancashire_logo.png" alt="University of Lancashire Logo" style="width:80%; opacity:0.75;">
        </div>
    </div>
</div>

<script>
const rawLogs = [
    {time: "17:59:00", source: "192.168.1.130", target: "8.8.4.4", action: "DNS Query (External resolver)"},
    {time: "17:59:05", source: "192.168.1.150", target: "192.168.1.5", action: "File server connection (User 'smit')"},
    {time: "17:59:10", source: "192.168.1.180", target: "Printer_Server", action: "Print Job initiated (Document: Q4_Budget_Review.xlsx)"},
    {time: "17:59:15", source: "192.168.1.101", target: "203.0.113.10", action: "Standard HTTPS Web traffic (News site)"},
    {time: "17:59:18", source: "192.168.1.170", target: "192.168.1.254", action: "ARP broadcast (Who is 192.168.1.254?)"},
    {time: "17:59:22", source: "192.168.1.120", target: "192.168.1.254", action: "DHCP lease renewal"},
    {time: "17:59:30", source: "192.168.1.201", target: "192.168.1.250", action: "Ping request (Network check)"},
    {time: "17:59:35", source: "192.168.1.160", target: "142.250.72.10", action: "Standard HTTPS Web traffic (Cloud storage sync)"},
    {time: "17:59:40", source: "192.168.1.177", target: "Mail_Server", action: "Email received (Subject: Project Update)"},
    {time: "17:59:50", source: "192.168.1.180", target: "8.8.8.8", action: "DNS query for 'internal-app.lan'"},
    {time: "18:00:00", source: "192.168.1.220", target: "Printer_Server", action: "Print Job initiated (Document: Syllabus_Draft.pdf)"},
    {time: "18:00:01", source: "192.168.1.201", target: "N/A", action: "Login successful (Internal user 'jdoe')"},
    {time: "18:00:05", source: "192.168.1.150", target: "40.77.167.99", action: "Microsoft Update Check"},
    {time: "18:00:15", source: "192.168.1.101", target: "192.168.1.5", action: "File read operation (Document: User_Manual.docx)"},
    {time: "18:00:20", source: "192.168.1.120", target: "192.168.1.254", action: "Time synchronization check (NTP)"},
    {time: "18:00:30", source: "192.168.1.201", target: "192.168.1.1", action: "Router status check"},
    {time: "18:00:40", source: "192.168.1.177", target: "216.58.212.174", action: "Standard HTTPS Web traffic (Google search)"},
    {time: "18:00:50", source: "192.168.1.220", target: "192.168.1.220", action: "Local task scheduled (System maintenance)"},
    {time: "18:01:00", source: "192.168.1.130", target: "8.8.4.4", action: "DNS Query (External resolver)"},
    {time: "18:01:10", source: "192.168.1.254", target: "8.8.8.8", action: "Routine DNS lookup (Health Check)"},
    {time: "18:01:25", source: "192.168.1.112", target: "52.1.2.3", action: "Video Conference stream started"},
    {time: "18:01:40", source: "192.168.1.160", target: "142.250.72.10", action: "Standard HTTPS Web traffic (Cloud storage sync)"},
    {time: "18:02:05", source: "192.168.1.201", target: "192.168.1.250", action: "Ping request (Network check)"},

    {time: "18:02:20", source: "203.0.113.50", target: "192.168.1.110", action: "SSH login successful (User 'db_user_backup')"},
    {time: "18:02:25", source: "192.168.1.110", target: "192.168.1.205", action: "ICMP Scan (Probing new subnet)"},
    {time: "18:02:35", source: "192.168.1.110", target: "192.168.1.110", action: "Local command execution: 'ping -c 5 192.168.1.240' (Target Validation)"},
    {time: "18:02:50", source: "192.168.1.110", target: "192.168.1.240", action: "SQL Connection Initiated (Attempt to bypass firewall)"},
    {time: "18:03:10", source: "192.168.1.240", target: "192.168.1.110", action: "File copy from DB: 'Student_Records_Backup.sql' (55 MB)"},

    {time: "18:03:20", source: "192.168.1.254", target: "Storage_Server", action: "Automated nightly backup (Status: 10% complete)"},

    {time: "18:03:30", source: "192.168.1.110", target: "203.0.113.50", action: "Large outbound file transfer: Student_Records_Backup.sql (70 MB)"},

    {time: "18:03:35", source: "192.168.1.101", target: "203.0.113.10", action: "Standard HTTPS Web traffic (News site)"},
    {time: "18:03:40", source: "192.168.1.112", target: "52.1.2.3", action: "Video Conference stream paused"},
    {time: "18:03:50", source: "203.0.113.50", target: "192.168.1.110", action: "External connection terminated (SSH session closed)"},
    {time: "18:04:00", source: "192.168.1.180", target: "Printer_Server", action: "Print Job initiated (Document: Research_Paper.pdf)"},
    {time: "18:04:15", source: "192.168.1.150", target: "192.168.1.5", action: "File server connection closed"}
];
// Will anyone notice this also includes 18:02:25192.168.1.110192.168.1.205ICMP Scan (Probing new subnet) - which is reconnaissance to discover is the SSH service is reachable?
let currentStep = 1;
const externalIP = '203.0.113.50';
const jumpHost = '192.168.1.110';
const remoteDesktop = '192.168.1.240';
const exploitedUser = 'db_user_backup';
const exfiltratedFile = 'Student_Records_Backup.sql';
let failedAttempts = 0;

document.addEventListener('DOMContentLoaded', () => {
    renderLogs(rawLogs);
    updateNarrative();
});

function renderLogs(logs) {
    const tbody = document.getElementById('log-body');
    tbody.innerHTML = '';
    logs.forEach(log => {
        const row = tbody.insertRow();
        row.insertCell().textContent = log.time;
        row.insertCell().textContent = log.source;
        row.insertCell().textContent = log.target;
        row.insertCell().textContent = log.action;
    });
}

function filterLogs() {
    const raw = document.getElementById('ipFilter').value;
    const filterValue = raw.trim().replace(/\s+/g, '').toLowerCase();

    const filteredResults = rawLogs.filter(log =>
        log.source.toLowerCase().replace(/\s+/g, '').includes(filterValue) ||
        log.target.toLowerCase().replace(/\s+/g, '').includes(filterValue) ||
        log.action.toLowerCase().replace(/\s+/g, '').includes(filterValue)
    );
    renderLogs(filteredResults);
}

function updateHelpPanel() {
    const strategyTip = document.getElementById('strategy-tip');

    switch(currentStep) {
        case 1:
            strategyTip.textContent = "Strategy: The attacker used **SSH**. Filter the log by that protocol to find the external Source_IP. Ignore the earlier 'Login successful' events, as they are internal noise.";
            break;
        case 2:
            strategyTip.textContent = `Strategy: Filter the logs using the attacker's IP (${externalIP}). When the attacker's IP is the 'Source_IP', the 'Target_IP' is the first internal machine they hit.`;
            break;
        case 3:
            strategyTip.textContent = `Strategy: Filter by the Entry Point's IP (${jumpHost}) as the 'Source_IP'. Look for the next move where they access a new computer using **'SQL'** (lateral movement). Ignore the ICMP scan, which is just reconnaissance.`;
            break;
        case 4:
            strategyTip.textContent = "Strategy: Revisit the very first SSH entry (Objective 1). The log's 'Action_Summary' explicitly names the account whose password was stolen.";
            break;
        case 5:
            strategyTip.textContent = `Strategy: Filter by the attacker's IP (${externalIP}), but this time check where it is the 'Target_IP'. This entry shows the file being stolen from the network.`;
            break;
        default:
            strategyTip.textContent = "Investigation Complete!";
            break;
    }
}

function toggleInputVisibility(isVisible) {
    const answerInput = document.getElementById('answerInput');
    const submitButton = answerInput.nextElementSibling; 
    
    answerInput.style.display = isVisible ? 'block' : 'none';
    submitButton.style.display = isVisible ? 'block' : 'none';
}


function updateNarrative() {
    const title = document.getElementById('current-step-title');
    const text = document.getElementById('narrative-text');
    const actionHeader = '<span class="action-header">Required Action:</span>';

    switch(currentStep) {
        case 1:
            title.textContent = "Objective 1: Identify Initial Access";
            text.innerHTML = actionHeader + " Identify the external IP address (the non-192.168 IP) that first successfully connected to your network. This is the attacker's starting point.";
            toggleInputVisibility(true);
            break;
        case 2:
            title.textContent = "Objective 2: Identify Compromised Host (Entry Point)";
            text.innerHTML = actionHeader + " Use the attacker's public IP to find the first internal computer they reached. Provide the internal IP address (192.168.x.x) of that machine.";
            toggleInputVisibility(true);
            break;
        case 3:
            title.textContent = "Objective 3: Identify Lateral Movement (Database Server)";
            text.innerHTML = actionHeader + " The attacker moved from the entry point to a high-value server using a network protocol. Identify the internal IP address of the machine they accessed next using SQL.";
            toggleInputVisibility(true);
            break;
        case 4:
            title.textContent = "Objective 4: Identify Exploited Credential";
            text.innerHTML = actionHeader + " Determine the User Account whose password the attacker stole and successfully used for initial access. Provide the exact user account name as seen in the logs.";
            toggleInputVisibility(true);
            break;
        case 5:
            title.textContent = "Objective 5: Identify Stolen Data";
            text.innerHTML = actionHeader + " The attacker stole the files by sending them back to their public IP. Identify the exact file name (case sensitive) of the critical evidence that was exfiltrated.";
            toggleInputVisibility(true);
            break;
        default:
            title.textContent = "Level 2 Investigation Concluded. üéâ";
            text.innerHTML = "You have successfully traced the attack from initial access to data exfiltration. All evidence points to a breach of the '" + jumpHost + "' and the theft of '" + exfiltratedFile + "'.";
            showNextLevelPrompt();
            toggleInputVisibility(false);
            break;
    }

    updateHelpPanel();
}

function showNextLevelPrompt() {
    const container = document.getElementById('next-level-container');
    container.innerHTML = `
        <div style="background: rgba(0,255,0,0.03); color:var(--accent); padding:12px; border-radius:8px; text-align:center;">
            <p>Excellent work, Detective! You've successfully navigated the noise.</p>
            <p style="margin-top:10px;"><strong>Official Documentation:</strong> <a href="Report2.html" target="_blank">View the Level 2 Investigation Report</a></p>
        </div>
    `;
}

function getIncorrectClue(step) {
    failedAttempts++;

    const clues = {
        1: [
            "Filter by the protocol 'SSH' or 'login'. The external IP is the Source_IP.",
            "Still stuck? The key is the word 'successful'. Use that keyword in the filter to find the entry."
        ],
        2: `Filter the logs using the attacker's public IP (${externalIP}) as the 'Source_IP'. Which internal IP is listed as the 'Target_IP' of the successful login?`,
        3: `Filter by the Entry Point IP (${jumpHost}) as the 'Source_IP'. Look for the next step where it moves to a new computer using a 'SQL' action.`,
        4: "Look closely at the 'Action_Summary' of the initial successful login (Objective 1). The exact stolen user account is explicitly mentioned.",
        5: "Filter the logs by 'Large outbound file transfer'. This is the stolen data leaving the network. The exact filename is visible in that entry."
    };

    if (step === 1) {
        const clueIndex = Math.min(failedAttempts - 1, clues[1].length - 1);
        return "Evidence rejected. <strong>Rethink your analysis:</strong> " + clues[1][clueIndex];
    } else {
        return "Evidence rejected. <strong>Rethink your analysis:</strong> " + clues[step];
    }
}

function validateAnswer() {
    const answerInput = document.getElementById('answerInput');
    const userAnswer = answerInput.value.trim().replace(/\s/g, '');
    const statusDiv = document.getElementById('statusMessage');
    statusDiv.className = 'status-message';

    const correctAnswers = {
        1: { value: externalIP, text: "Correct. The initial breach came from the external address " + externalIP + "." },
        2: { value: jumpHost, text: "Verification confirmed. The initial host compromised was the Entry Point (" + jumpHost + ")." },
        3: { value: remoteDesktop, text: "Verification confirmed. The Database Server (" + remoteDesktop + ") was the first lateral target." },
        4: { value: exploitedUser, text: "Verification confirmed. The credentials used were for the highly privileged user '" + exploitedUser + "'." },
        5: { value: exfiltratedFile, text: "Investigation complete. The breach successfully exfiltrated the file " + exfiltratedFile + "." }
    };

    const answerObj = correctAnswers[currentStep];

    if (answerObj && userAnswer === answerObj.value) {
        statusDiv.classList.add('success');
        statusDiv.textContent = answerObj.text;
        currentStep++;
        failedAttempts = 0;
        answerInput.value = '';
        updateNarrative();
    } else {
        statusDiv.classList.add('error');
        statusDiv.innerHTML = getIncorrectClue(currentStep);
    }
}

</script>
</body>
</html>